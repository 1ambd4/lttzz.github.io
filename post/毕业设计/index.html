<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>毕业设计 - LTTZZ&#39;s BLOG</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="lttzz" /><meta name="description" content="毕设选题：个性化新闻阅读系统移动端的设计与实现
" /><meta name="keywords" content="Hugo, theme, even, lttzz" />






<meta name="generator" content="Hugo 0.104.3 with theme even" />


<link rel="canonical" href="https://lttzz.github.io/post/%E6%AF%95%E4%B8%9A%E8%AE%BE%E8%AE%A1/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="毕业设计" />
<meta property="og:description" content="毕设选题：个性化新闻阅读系统移动端的设计与实现" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://lttzz.github.io/post/%E6%AF%95%E4%B8%9A%E8%AE%BE%E8%AE%A1/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-01-17T11:49:27+08:00" />
<meta property="article:modified_time" content="2021-01-17T11:49:27+08:00" />

<meta itemprop="name" content="毕业设计">
<meta itemprop="description" content="毕设选题：个性化新闻阅读系统移动端的设计与实现"><meta itemprop="datePublished" content="2021-01-17T11:49:27+08:00" />
<meta itemprop="dateModified" content="2021-01-17T11:49:27+08:00" />
<meta itemprop="wordCount" content="6659">
<meta itemprop="keywords" content="andorid," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="毕业设计"/>
<meta name="twitter:description" content="毕设选题：个性化新闻阅读系统移动端的设计与实现"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">LTTZZ&#39;s BLOG</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/books/">
        <li class="mobile-menu-item">Books</li>
      </a><a href="/nonsense/">
        <li class="mobile-menu-item">Nonsense</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">LTTZZ&#39;s BLOG</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/books/">Books</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/nonsense/">Nonsense</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">毕业设计</h1>

      <div class="post-meta">
        <span class="post-time"> 2021-01-17 </span>
        
          <span class="more-meta"> 6659 words </span>
          <span class="more-meta"> 14 mins read </span>
        <span id="busuanzi_container_page_pv" class="more-meta"> <span id="busuanzi_value_page_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> times read </span>
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#0x00-序言预备知识">0x00 序言&amp;预备知识</a>
      <ul>
        <li><a href="#ui设计">UI设计</a></li>
        <li><a href="#android">Android</a></li>
        <li><a href="#java">Java</a></li>
        <li><a href="#django">Django</a></li>
        <li><a href="#latex">LaTeX</a></li>
      </ul>
    </li>
    <li><a href="#docker">Docker</a></li>
    <li><a href="#0x01-爬虫">0x01 爬虫</a>
      <ul>
        <li><a href="#黑马爬虫课程">黑马爬虫课程</a>
          <ul>
            <li><a href="#爬虫基础">爬虫基础</a></li>
            <li><a href="#requests模块">requests模块</a></li>
            <li><a href="#数据提取">数据提取</a></li>
            <li><a href="#selenium">selenium</a></li>
            <li><a href="#反爬与反反爬">反爬与反反爬</a></li>
            <li><a href="#验证码">验证码</a></li>
            <li><a href="#mongodb数据库">MongoDB数据库</a></li>
            <li><a href="#scrapy基础">scrapy基础</a></li>
            <li><a href="#scrapy-redis">scrapy-redis</a></li>
            <li><a href="#scrapy其他">scrapy其他</a></li>
            <li><a href="#appium">appium</a></li>
          </ul>
        </li>
        <li><a href="#增量式爬虫">增量式爬虫</a>
          <ul>
            <li><a href="#bloomfilter">BloomFilter</a></li>
            <li><a href="#redis">Redis</a></li>
            <li><a href="#定时爬虫">定时爬虫</a></li>
          </ul>
        </li>
        <li><a href="#scrapy">Scrapy</a></li>
        <li><a href="#参考">参考</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>毕设选题：个性化新闻阅读系统移动端的设计与实现</p>
<h1 id="0x00-序言预备知识">0x00 序言&amp;预备知识</h1>
<p>早受够了乱七八糟的APP，想自己写一套资讯聚合系统，利用碎片化的时间了解近期社会、行业的动态，刚巧毕设系统看到了，赶忙选了，ddl在那儿，没借口不去实现了吧 <del>似乎给自己挖了个坑</del>。</p>
<h2 id="ui设计">UI设计</h2>
<p><a href="https://www.bilibili.com/video/BV1zK4y1v7wy">1小时掌握Adobe Xd</a></p>
<p><a href="https://www.bilibili.com/video/BV1gt411h7Aw">超人的电话亭公开课 - XD高级交互动画详解</a></p>
<h2 id="android">Android</h2>
<p><a href="https://www.bilibili.com/video/BV16Z4y1H7jj">Android实战项目: 视频资讯APP</a></p>
<p><a href="https://yq.aliyun.com/attachment/download/?id=5259">阿里巴巴Android开发手册</a></p>
<h2 id="java">Java</h2>
<p><a href="https://www.bilibili.com/video/BV1Rx411876f">Java零基础教程视频</a></p>
<h2 id="django">Django</h2>
<p><a href="https://www.bilibili.com/video/BV1Wt411K7QH">通俗易懂Python Django网站开发绝对零入门(1小时入门)第一季</a></p>
<p><a href="https://www.bilibili.com/video/BV1mW411G7g6">Python全栈（老男孩4期）Django框架入门到应用</a></p>
<h2 id="latex">LaTeX</h2>
<p><a href="https://www.bilibili.com/video/BV1fA411W7kZ">Overleaf入门，带你快速上手LaTeX</a></p>
<p><a href="https://www.bilibili.com/video/BV1Ma4y1p7Q6">Overleaf进阶，更多技能等你解锁</a></p>
<p><a href="https://www.bilibili.com/video/BV1aK411u7us">Overleaf高阶，收割更多技能</a></p>
<h1 id="docker">Docker</h1>
<p><a href="https://book.douban.com/subject/26285268/">《第一本Docker书》</a></p>
<h1 id="0x01-爬虫">0x01 爬虫</h1>
<ul>
<li>爬虫：模拟客户端，发送请求，解析响应。</li>
<li>lowbi 浏览器我真的笑了
<ul>
<li>&lsquo;User-Agent&rsquo; : &lsquo;Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/4.0)&rsquo;</li>
</ul>
</li>
</ul>
<h2 id="黑马爬虫课程">黑马爬虫课程</h2>
<ul>
<li>善用无痕模式</li>
</ul>
<h3 id="爬虫基础">爬虫基础</h3>
<h4 id="爬虫的作用">爬虫的作用</h4>
<ul>
<li>数据采集</li>
<li>软件测试</li>
<li>抢票刷票</li>
<li>网络安全</li>
</ul>
<h4 id="爬虫的分类">爬虫的分类</h4>
<ul>
<li>爬虫规模
<ul>
<li>通用爬虫</li>
<li>聚焦爬虫</li>
</ul>
</li>
<li>目的
<ul>
<li>功能性爬虫（不获取数据，只为实现某一个功能，如抢票刷票短信轰炸等）</li>
<li>增量式爬虫（url、数据变化）</li>
</ul>
</li>
</ul>
<h4 id="http协议">http协议</h4>
<p>爬虫关心的数据部分：</p>
<ul>
<li>请求头
<ul>
<li><strong>Host</strong></li>
<li><strong>User-Agent</strong></li>
<li>Connection</li>
<li>Upgrade-Insecure-Requests（升级为https）</li>
<li><strong>Referer（用于反爬和防盗链）</strong></li>
<li>Content-Type</li>
<li><strong>Cookie</strong></li>
<li>Authorization</li>
</ul>
</li>
<li>响应头
<ul>
<li><strong>Set-Cookie</strong></li>
</ul>
</li>
</ul>
<p>状态码：</p>
<ul>
<li>200 成功</li>
<li>302 跳转</li>
<li>303 POST重定向</li>
<li>307 GET重定向</li>
<li>403 资源不可用</li>
<li>404 找不到页面</li>
<li>500 服务器内部错误</li>
<li>503 服务器由于维护或者负载过重未能应答</li>
</ul>
<p>所有的状态码都不可信，一切以是否从抓包得到的数据中获取到的数据为准。（network中抓包得到的源码才是判断依据，elements中的数据是渲染后的数据，不能作为判断依据。）</p>
<p>浏览器发送所有的请求并进行渲染，爬虫只发送指定的请求不进行渲染。</p>
<h4 id="抓包">抓包</h4>
<p>html静态文件（骨骼）、js/ajax请求（肌肉）、css/font/图片（皮肤）</p>
<h3 id="requests模块">requests模块</h3>
<p>知识点：</p>
<ul>
<li>header参数的使用</li>
<li>发送带参数的请求</li>
<li>header中携带cookie</li>
<li>cookie参数的使用</li>
<li>cookieJar的转换方式</li>
<li>timeout的使用</li>
<li>代理ip参数proxies的使用</li>
<li>使用verify参数忽略CA证书</li>
<li>发送post请求</li>
<li>利用requests.session进行状态保持</li>
</ul>
<h4 id="代理">代理</h4>
<ul>
<li>正向代理：vpn（知道最终服务器的地址）</li>
<li>反向代理：nginx</li>
</ul>
<h5 id="代理ip的分类">代理ip的分类</h5>
<ul>
<li>按照匿名度
<ul>
<li>透明代理（知道</li>
<li>匿名代理</li>
<li>高密代理</li>
</ul>
</li>
<li>按协议分类
<ul>
<li>http</li>
<li>https</li>
<li>socks</li>
</ul>
</li>
</ul>
<h4 id="使用verify参数忽略ca证书">使用verify参数忽略CA证书</h4>
<h4 id="response">response</h4>
<p>text			 str</p>
<p>content	  byte</p>
<h4 id="发送post请求">发送post请求</h4>
<p>登录、注册、发送大文本的时候，需要用到post请求。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 金山词霸查询</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">sys</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Iciba</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">word</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://ifanyi.iciba.com/index.php?c=trans&amp;m=fy&amp;client=6&amp;auth_user=key_ciba&amp;sign=dcd0cdb9563fcec1&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;User-Agent&#39;</span> <span class="p">:</span> <span class="s1">&#39;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.85 Safari/537.36&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;from&#39;</span> <span class="p">:</span> <span class="s1">&#39;en&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;to&#39;</span> <span class="p">:</span> <span class="s1">&#39;auto&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;q&#39;</span> <span class="p">:</span> <span class="s1">&#39;china&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">parse_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">result</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">][</span><span class="s1">&#39;out&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">parse_data</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">iciba</span> <span class="o">=</span> <span class="n">Iciba</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="n">iciba</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="post数据来源">post数据来源</h5>
<ul>
<li>固定值（金山词霸
<ul>
<li>抓包比较不变值</li>
</ul>
</li>
<li>输入值
<ul>
<li>抓包比较变化值</li>
</ul>
</li>
<li>预设值（百度翻译token）
<ul>
<li>静态文件中的预设值：需要提前从静态html中获取</li>
</ul>
</li>
<li>预设值（github登录token）
<ul>
<li>需要对指定的地址发送请求获取</li>
</ul>
</li>
<li>在客户端生成的（有道翻译sign）</li>
</ul>
<h4 id="requestssession进行状态保持">requests.session进行状态保持</h4>
<p>session类可以自动处理cookie，即下一次的请求自动带上前一次的cookie</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">session</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">response</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">response</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>抓包的时候，勾选一下Preserve log。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">re</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">sys</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">login</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">   <span class="c1"># session</span>
</span></span><span class="line"><span class="cl">   <span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">session</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="c1"># headers</span>
</span></span><span class="line"><span class="cl">   <span class="n">session</span><span class="o">.</span><span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">           <span class="s1">&#39;User-Agent&#39;</span> <span class="p">:</span> <span class="s1">&#39;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.85 Safari/537.36&#39;</span>
</span></span><span class="line"><span class="cl">           <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="c1"># url1 - 获取token</span>
</span></span><span class="line"><span class="cl">       <span class="c1"># 发送请求获取响应</span>
</span></span><span class="line"><span class="cl">       <span class="c1"># 正则提取token</span>
</span></span><span class="line"><span class="cl">   <span class="n">url1</span> <span class="o">=</span> <span class="s1">&#39;https://github.com/login&#39;</span>
</span></span><span class="line"><span class="cl">   <span class="n">res1</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url1</span><span class="p">)</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">   <span class="n">authenticity_token</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;&lt;form action=&#34;/session&#34; accept-charset=&#34;UTF-8&#34; method=&#34;post&#34;&gt;&lt;input type=&#34;hidden&#34; name=&#34;authenticity_token&#34; value=&#34;(.*?)&#34; /&gt;&#39;</span><span class="p">,</span> <span class="n">res1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">   <span class="n">timestamp_secret</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;&lt;input type=&#34;hidden&#34; name=&#34;timestamp_secret&#34; value=&#34;(.*?)&#34; class=&#34;form-control&#34; /&gt;&#39;</span><span class="p">,</span> <span class="n">res1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">   <span class="nb">print</span><span class="p">(</span><span class="n">authenticity_token</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="nb">print</span><span class="p">(</span><span class="n">timestamp_secret</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="c1"># url2 - 登录</span>
</span></span><span class="line"><span class="cl">       <span class="c1"># 构建发送表单</span>
</span></span><span class="line"><span class="cl">       <span class="c1"># 发送登录请求</span>
</span></span><span class="line"><span class="cl">   <span class="n">url2</span> <span class="o">=</span> <span class="s1">&#39;https://github.com/session&#39;</span>
</span></span><span class="line"><span class="cl">   <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">           <span class="s1">&#39;commit&#39;</span> <span class="p">:</span> <span class="s1">&#39;Sign in&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">           <span class="s1">&#39;authenticity_token&#39;</span> <span class="p">:</span> <span class="n">authenticity_token</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">           <span class="s1">&#39;login&#39;</span> <span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">           <span class="s1">&#39;password&#39;</span> <span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">           <span class="s1">&#39;trusted_device&#39;</span> <span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">           <span class="s1">&#39;webauthn-support&#39;</span> <span class="p">:</span> <span class="s1">&#39;supported&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">           <span class="s1">&#39;webauthn-iuvpaa-support&#39;</span> <span class="p">:</span> <span class="s1">&#39;unsupported&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">           <span class="s1">&#39;return_to&#39;</span> <span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">           <span class="s1">&#39;allow_signup&#39;</span> <span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">           <span class="s1">&#39;client_id&#39;</span> <span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">           <span class="s1">&#39;integration&#39;</span> <span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">           <span class="s1">&#39;required_field_4ffc&#39;</span> <span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">           <span class="s1">&#39;timestamp&#39;</span> <span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">13</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">           <span class="s1">&#39;timestamp_secret&#39;</span> <span class="p">:</span> <span class="n">timestamp_secret</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">           <span class="p">}</span>
</span></span><span class="line"><span class="cl">   <span class="n">res2</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url2</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="c1"># url3 - 验证是否登录成功</span>
</span></span><span class="line"><span class="cl">   <span class="n">url3</span> <span class="o">=</span> <span class="s1">&#39;https://github.com/lttzz&#39;</span>
</span></span><span class="line"><span class="cl">   <span class="n">res3</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;github.html&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">       <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">res3</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">   <span class="n">login</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="数据提取">数据提取</h3>
<h4 id="响应内容的分类">响应内容的分类</h4>
<ul>
<li>结构化数据
<ul>
<li>json（高频出现）
<ul>
<li>json</li>
<li>re</li>
<li>jsonpath</li>
</ul>
</li>
<li>xml（低频出现）
<ul>
<li>re</li>
<li>lxml：xpath</li>
</ul>
</li>
</ul>
</li>
<li>非结构化数据
<ul>
<li>html：
<ul>
<li>re</li>
<li>lxml：xpath</li>
<li>beautifulsoup：xpath、正则、css选择器</li>
<li>pyquery：css选择器</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="html和xml的区别">html和xml的区别</h4>
<p>html的标签固定，被设计为显示数据以及如何更好的显示数据，侧重点是数据的显示。</p>
<p>xml标签可以自定义，被设计为传输和存储数据，焦点是数据的内容。</p>
<h4 id="jsonpath">jsonpath</h4>
<p>使用场景：多层嵌套的复杂字典提取数据</p>
<h5 id="语法规则返回的结果为列表">语法规则（返回的结果为列表）</h5>
<table>
<thead>
<tr>
<th style="text-align:center">表达式</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$</td>
<td style="text-align:center">根节点</td>
</tr>
<tr>
<td style="text-align:center">.</td>
<td style="text-align:center">字节点</td>
</tr>
<tr>
<td style="text-align:center">..</td>
<td style="text-align:center">子孙节点</td>
</tr>
</tbody>
</table>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;key1&#39;</span><span class="p">:{</span><span class="s1">&#39;key2&#39;</span><span class="p">:{</span><span class="s1">&#39;key3&#39;</span><span class="p">:{</span><span class="s1">&#39;key4&#39;</span><span class="p">:{</span><span class="s1">&#39;key5&#39;</span><span class="p">:{</span><span class="s1">&#39;key6&#39;</span><span class="p">:{</span><span class="s1">&#39;key7&#39;</span><span class="p">:</span><span class="s1">&#39;python&#39;</span><span class="p">}}}}}}}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># str to json</span>
</span></span><span class="line"><span class="cl"><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># json</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span><span class="p">[</span><span class="s1">&#39;key1&#39;</span><span class="p">][</span><span class="s1">&#39;key2&#39;</span><span class="p">][</span><span class="s1">&#39;key3&#39;</span><span class="p">][</span><span class="s1">&#39;key4&#39;</span><span class="p">][</span><span class="s1">&#39;key5&#39;</span><span class="p">][</span><span class="s1">&#39;key6&#39;</span><span class="p">][</span><span class="s1">&#39;key7&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># jsonpath</span>
</span></span><span class="line"><span class="cl"><span class="n">jsonpath</span><span class="o">.</span><span class="n">jsonpath</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;$..key7&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="lxml">lxml</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># etree.HTML()能够补全缺失的html标签</span>
</span></span><span class="line"><span class="cl"><span class="n">html</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">HTML</span><span class="p">(</span><span class="s2">&#34;html_text&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s2">&#34;xpath_string&#34;</span><span class="p">)</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="xpath基础语法">xpath基础语法</h4>
<table>
<thead>
<tr>
<th style="text-align:center">表达式</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">nodename</td>
<td style="text-align:center">选中元素</td>
</tr>
<tr>
<td style="text-align:center">/</td>
<td style="text-align:center">绝对路径（子节点）</td>
</tr>
<tr>
<td style="text-align:center">//</td>
<td style="text-align:center">相对路径（子孙节点）</td>
</tr>
<tr>
<td style="text-align:center">.</td>
<td style="text-align:center">当前节点</td>
</tr>
<tr>
<td style="text-align:center">..</td>
<td style="text-align:center">父节点</td>
</tr>
<tr>
<td style="text-align:center">@</td>
<td style="text-align:center">选取标签属性</td>
</tr>
<tr>
<td style="text-align:center">text()</td>
<td style="text-align:center">选取标签间的文本</td>
</tr>
</tbody>
</table>
<h4 id="xpath节点修饰语法">xpath节点修饰语法</h4>
<ul>
<li>通过索引值修饰节点
<ul>
<li>/html//div[last()-1]</li>
<li>/html//div[postion()&gt;10]</li>
</ul>
</li>
<li>通过属性值修饰节点
<ul>
<li>/html//div[@id=&ldquo;main&rdquo;]</li>
</ul>
</li>
<li>通过子节点值修饰节点
<ul>
<li>//span[i&gt;1000]             span下有i属性表示用户评级，选择评级大于1000的</li>
</ul>
</li>
<li>通过包含修饰（文本包含，属性包含）
<ul>
<li>//span[contains(text(), &ldquo;下一页&rdquo;)]       文本包含，文本中包含下一页</li>
<li>//div[contains(@id, &ldquo;qiushi_tag_&rdquo;)]      属性包含，属性中的有id值，后面的字符串用于进一步匹配，如：qiushi_tag_124254747</li>
</ul>
</li>
</ul>
<h4 id="xpath选择未知节点的语法通配符">xpath选择未知节点的语法（通配符）</h4>
<table>
<thead>
<tr>
<th style="text-align:center">通配符</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">*</td>
<td style="text-align:center">匹配任何节点</td>
</tr>
<tr>
<td style="text-align:center">@*</td>
<td style="text-align:center">匹配任何属性的节点</td>
</tr>
<tr>
<td style="text-align:center">node()</td>
<td style="text-align:center">匹配任意类型的节点</td>
</tr>
</tbody>
</table>
<h4 id="xpath其他语法">xpath其他语法</h4>
<p>复合语法：｜</p>
<p>//span[i&gt;1000] | //span[i&gt;500]</p>
<p>选择$i&gt;1000$或者$i&lt;500$，并不会造成短路。</p>
<h4 id="爬百度贴吧">爬百度贴吧</h4>
<ul>
<li>User-Agent</li>
<li>json.dumps</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Tieba</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;https://tieba.baidu.com/f?kw=</span><span class="si">{}</span><span class="s2">&amp;ie=utf-8&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;User-Agent&#39;</span> <span class="p">:</span> <span class="s1">&#39;Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/4.0)&#39;</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># &#39;User-Agent&#39; : &#39;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.85 Safari/537.36&#39;</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">parse_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">html</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">HTML</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">el_list</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//*[@id=&#34;thread_list&#34;]/li//a[contains(@href, &#34;/p/&#34;)]&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># print(len(el_list))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">data_list</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">el_list</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">temp</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">            <span class="n">temp</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;./text()&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">temp</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;https://tieba.baidu.com&#39;</span> <span class="o">+</span> <span class="n">el</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;./@href&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="n">data_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">next_url</span> <span class="o">=</span> <span class="s1">&#39;https:&#39;</span> <span class="o">+</span> <span class="n">html</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//a[contains(text(), &#34;下一页&#34;)]/@href&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="k">except</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">next_url</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">data_list</span><span class="p">,</span> <span class="n">next_url</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">save_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_list</span><span class="p">):</span>    
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">data_list</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;tieba.json&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># 1、url</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># 2、headers</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># 3、发送请求获取响应</span>
</span></span><span class="line"><span class="cl">        <span class="n">next_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span>
</span></span><span class="line"><span class="cl">        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">next_url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">parse_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># 4、提取数据</span>
</span></span><span class="line"><span class="cl">            <span class="n">data_list</span><span class="p">,</span> <span class="n">next_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">save_data</span><span class="p">(</span><span class="n">data_list</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="n">next_url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># 5、判断是否结束</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">next_url</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">break</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">tieba</span> <span class="o">=</span> <span class="n">Tieba</span><span class="p">(</span><span class="s1">&#39;斋藤飞鸟&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">tieba</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="selenium">selenium</h3>
<p>PhantomJS是一款基于webkit的无界面浏览器，利用浏览器原生API，封装成一套更加面向对象的Selenium WebDriver API，直接操作浏览器页面里的元素，甚至直接操作浏览器本身。</p>
<p>chrome也支持了无头模式，创建浏览器对象的时候传入适当的参数即可。代理、user-agent等也是照此配置。</p>
<p>click()函数的调用需要待点击元素在当前浏览器页面上可以看到，否则无法点击，报错unknow error。</p>
<h5 id="定位元素">定位元素</h5>
<ul>
<li>find_element_by_id</li>
<li>find_element(s)_by_xpath</li>
<li>find_element(s)_by_css_selector</li>
<li>find_element(s)_by_name</li>
<li>find_element(s)_by_class_name</li>
<li>find_element(s)_by_link_text</li>
<li>find_element(s)_by_partial_link_text</li>
<li>find_element(s)_by_tag_name  （只能返回定位出来的标签中的第一个）</li>
</ul>
<p>find_element_by_xxx：定位到则是一个对象，定位不到则报错</p>
<p>find_elements_by_xxx：定位到则是一个含有元素的列表，定位不到则是一个空列表。</p>
<p>frame需要使用<code>driver.switch_to.frame()</code> 切换。</p>
<h4 id="等待">等待</h4>
<ul>
<li>强制等待：即time.sleep()，不智能，太长太短无法精确</li>
<li>隐式等待：<code>drive.implicitly_wait()</code>类似timeout，对后续都生效</li>
<li>显式等待：明确的等待某一个元素，多用在软件测试中。</li>
</ul>
<h3 id="反爬与反反爬">反爬与反反爬</h3>
<p>三月爬虫我哭了，明明四月才开始嗷。</p>
<h4 id="反爬的方向">反爬的方向</h4>
<ul>
<li>基于身份识别进行反爬</li>
<li>基于爬虫行为进行反爬</li>
<li>基于数据加密进行反爬</li>
</ul>
<h4 id="基于身份识别的反爬">基于身份识别的反爬</h4>
<ul>
<li>请求头
<ul>
<li>User-Agent：尽量使用User-Agent池</li>
<li>Referer：正常浏览很多都会带这个参数，但爬虫不会，添加之</li>
<li>cookie</li>
</ul>
</li>
<li>请求参数
<ul>
<li>参数在html静态文件中（github登录）</li>
<li>发送请求获取数据</li>
<li>通过js生成请求参数</li>
<li>通过验证码反爬</li>
</ul>
</li>
</ul>
<h4 id="基于爬虫行为的反爬">基于爬虫行为的反爬</h4>
<ul>
<li>请求频率和请求总数：ip/账号和请求频率、请求间隔、请求数量等的关系</li>
<li>通过js实现的跳转进行反爬：无法在源码中找到下一页的url</li>
<li>通过蜜罐获取爬虫ip和代理ip进行反爬：某些正常用户不可能访问到的数据设置蜜罐，疯掉ip</li>
<li>通过加数据进行反爬：增大数据清洗难度</li>
<li>阻塞任务队列</li>
<li>阻塞网络IO：在蜜罐中混入大文件的url，占用网络IO性能</li>
<li>运维平台综合审计</li>
</ul>
<h4 id="基于数据加密的反爬">基于数据加密的反爬</h4>
<p>对响应的数据进行处理</p>
<ul>
<li>css数据偏移（去哪儿的票价）</li>
<li>自定义字体</li>
<li>数据加密</li>
<li>数据图片化（58同城短租）</li>
<li>特殊格式编码</li>
<li>js动态生成数据</li>
</ul>
<h3 id="验证码">验证码</h3>
<p>处理方案：</p>
<ul>
<li>手动输入</li>
<li>ocr：tesseract、腾讯/阿里ocr平台</li>
<li>打码平台</li>
</ul>
<p>对于点击后会变化的验证码，常用selenium截屏后将验证码剪裁出来后在处理验证码。</p>
<h4 id="tesseract">tesseract</h4>
<p>GitHub : <a href="https://github.com/tesseract-ocr/tesseract">tesseract-ocr/tesseract</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ pip install pillow
</span></span><span class="line"><span class="cl">$ pip install pytesseract
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># tesseract的简单使用</span>
</span></span><span class="line"><span class="cl">from PIL import Image
</span></span><span class="line"><span class="cl">import pytesseract
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">im</span> <span class="o">=</span> Imgae.open<span class="o">(</span><span class="s1">&#39;image_path&#39;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">result</span> <span class="o">=</span> pytesseract.image_to_string<span class="o">(</span>im<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">print<span class="o">(</span>result<span class="o">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="js解析">js解析</h4>
<ul>
<li>1、定位js文件
<ul>
<li>通过initiator定位到js文件</li>
<li>通过搜索关键字定位到js文件</li>
<li>分析元素（如按钮）上的事件监听器</li>
</ul>
</li>
<li>2、分析js代码（可以添加断点调试）</li>
<li>3、模拟加密步骤
<ul>
<li>调用第三方类库，js2py、pyv8、execjs</li>
<li>用python重写代码</li>
</ul>
</li>
</ul>
<h4 id="js2py人人网登录">js2py（人人网登录）</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">js2py</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 创建环境</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span> <span class="o">=</span> <span class="n">js2py</span><span class="o">.</span><span class="n">EvalJs</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 加载js</span>
</span></span><span class="line"><span class="cl"><span class="n">xxxJS</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">xxxJS</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="hashlib">hashlib</h4>
<h4 id="去重">去重</h4>
<p>地址去重：</p>
<ul>
<li>url</li>
<li>hash(url)</li>
<li>布隆过滤器</li>
</ul>
<p>文本内容去重：</p>
<ul>
<li>编辑距离</li>
<li>simhash（模糊哈希）</li>
</ul>
<h3 id="mongodb数据库">MongoDB数据库</h3>
<h4 id="mongodb的介绍与安装">MongoDB的介绍与安装</h4>
<p>端口号：27017</p>
<p>默认配置文件：/etc/mongod.conf</p>
<p>配置文件：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 使用-f指定</span>
</span></span><span class="line"><span class="cl"><span class="nv">dbpath</span><span class="o">=</span>~/mongodb
</span></span><span class="line"><span class="cl"><span class="nv">logpath</span><span class="o">=</span>~/mongodb/mongodb.log
</span></span><span class="line"><span class="cl"><span class="nv">logappend</span><span class="o">=</span><span class="nb">true</span>
</span></span><span class="line"><span class="cl"><span class="nv">fork</span><span class="o">=</span><span class="nb">true</span>
</span></span><span class="line"><span class="cl"><span class="nv">auth</span><span class="o">=</span><span class="nb">true</span>
</span></span><span class="line"><span class="cl"><span class="nv">bind_ip</span><span class="o">=</span>0.0.0.0
</span></span></code></pre></td></tr></table>
</div>
</div><p>启动方式：</p>
<ul>
<li>测试方式启动</li>
<li>生产环境启动</li>
</ul>
<p>SQL：数据库 &gt; 表 &gt; 数据</p>
<p>NoSQL：数据库 &gt; 集合 &gt; 文档</p>
<h5 id="测试方式启动">测试方式启动</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Ubuntu18.04</span>
</span></span><span class="line"><span class="cl"><span class="c1"># https://mirror.tuna.tsinghua.edu.cn/help/mongodb/</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#首先信任 MongoDB 的 GPG 公钥:</span>
</span></span><span class="line"><span class="cl">wget -qO - https://www.mongodb.org/static/pgp/server-4.4.asc <span class="p">|</span> sudo apt-key add -
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 再选择你的 Debian / Ubuntu 版本，文本框中内容写进 /etc/apt/sources.list.d/mongodb.list</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 你的 Debian/Ubuntu 版本: </span>
</span></span><span class="line"><span class="cl"><span class="c1">#   Ubuntu 18.04 LTS</span>
</span></span><span class="line"><span class="cl">deb https://mirrors.tuna.tsinghua.edu.cn/mongodb/apt/ubuntu bionic/mongodb-org/4.4 multiverse
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 安装 mongodb-org 即可</span>
</span></span><span class="line"><span class="cl">sudo apt-get update
</span></span><span class="line"><span class="cl">sudo apt-get install -y mongodb-org
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 启动</span>
</span></span><span class="line"><span class="cl">service mongod start
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="生产环境启动">生产环境启动</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mongod <span class="o">[</span>option<span class="o">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><table>
<thead>
<tr>
<th style="text-align:left">参数</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">&ndash;dbpath</td>
<td>指定数据库存放路径</td>
</tr>
<tr>
<td style="text-align:left">&ndash;logpath</td>
<td>指定日志的存放路径</td>
</tr>
<tr>
<td style="text-align:left">&ndash;append/logappend</td>
<td>以追加模式写入日志</td>
</tr>
<tr>
<td style="text-align:left">&ndash;fork</td>
<td>开启新进程运行mongodb服务</td>
</tr>
<tr>
<td style="text-align:left">-f PATH</td>
<td>加载配置文件</td>
</tr>
<tr>
<td style="text-align:left">&ndash;auth</td>
<td>以权限认证的方式启动</td>
</tr>
</tbody>
</table>
<h4 id="mongodb命令">MongoDB命令</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 数据库命令</span>
</span></span><span class="line"><span class="cl">db													显示当前的数据库
</span></span><span class="line"><span class="cl">show databases/show dbs			查看所有的数据库
</span></span><span class="line"><span class="cl">use db_name									使用数据库
</span></span><span class="line"><span class="cl">db.dropDatabase<span class="o">()</span>						删除当前的数据库
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 集合命令</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 无需手动创建，向不存在的集合第一次插入数据的时候，集合会被创建</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 手动创建</span>
</span></span><span class="line"><span class="cl">db.createCollection<span class="o">(</span>name, option<span class="o">)</span>
</span></span><span class="line"><span class="cl">db.createCollection<span class="o">(</span><span class="s2">&#34;stu&#34;</span>, <span class="o">{</span>capped:true, size:10<span class="o">})</span>  <span class="c1"># 当文件大小超过预设值时，会覆盖数据</span>
</span></span><span class="line"><span class="cl">show collections
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 增删改查</span>
</span></span><span class="line"><span class="cl"><span class="c1"># COLLECTION 表示集合名称</span>
</span></span><span class="line"><span class="cl">db.COLLECTION.insert<span class="o">({})</span>						   <span class="c1"># 单一插入</span>
</span></span><span class="line"><span class="cl">db.COLLECTION.insert<span class="o">([{}</span>, <span class="o">{}</span>, ...<span class="o">])</span>    <span class="c1"># 批量插入，效率高</span>
</span></span><span class="line"><span class="cl"><span class="c1"># upsert （update or insert）</span>
</span></span><span class="line"><span class="cl">db.COLLECTION.save<span class="o">({</span>_id:<span class="s1">&#39;V&#39;</span>, xxx:yyy, ...<span class="o">})</span>
</span></span><span class="line"><span class="cl">db.COLLECTION.save<span class="o">({</span>xxx:yyy, ...<span class="o">})</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 查询操作</span>
</span></span><span class="line"><span class="cl">db.COLLECTION.find<span class="o">()</span>
</span></span><span class="line"><span class="cl">db.COLLECTION.find<span class="o">()</span>.pretty<span class="o">()</span>
</span></span><span class="line"><span class="cl">		<span class="nv">$lt</span>
</span></span><span class="line"><span class="cl">		<span class="nv">$lte</span>
</span></span><span class="line"><span class="cl">		<span class="nv">$gt</span>
</span></span><span class="line"><span class="cl">		<span class="nv">$gte</span>
</span></span><span class="line"><span class="cl">		<span class="nv">$ne</span>
</span></span><span class="line"><span class="cl">db.COLLECTION.find<span class="o">({</span>age:18<span class="o">})</span>				 <span class="c1"># 年龄为18</span>
</span></span><span class="line"><span class="cl">db.COLLECTION.find<span class="o">({</span>age:<span class="o">{</span><span class="nv">$gt</span>:18<span class="o">}})</span>   <span class="c1"># 年龄大雨18</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 复合查询（逻辑运算符）</span>
</span></span><span class="line"><span class="cl">db.COLLECTION.find<span class="o">({</span><span class="nv">$and</span><span class="o">[{</span>age:18<span class="o">}</span>, <span class="o">{</span>gender:false<span class="o">}]})</span>
</span></span><span class="line"><span class="cl">db.COLLECTION.find<span class="o">({</span><span class="nv">$or</span><span class="o">[{</span>age:18<span class="o">}</span>, <span class="o">{</span>gender:false<span class="o">}]})</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 范围运算符</span>
</span></span><span class="line"><span class="cl">db.COLLECTION.find<span class="o">({</span>age:<span class="o">{</span><span class="nv">$in</span>:<span class="o">[</span>18, 19, 20<span class="o">]}})</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 正则查询</span>
</span></span><span class="line"><span class="cl">db.COLLECTION.find<span class="o">({</span>name:<span class="o">[</span><span class="nv">$regex</span>:<span class="s2">&#34;^李&#34;</span><span class="o">]})</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 自定义函数</span>
</span></span><span class="line"><span class="cl">db.COLLECTION.find<span class="o">({</span><span class="nv">$where</span>:function<span class="o">()</span>
</span></span><span class="line"><span class="cl">		 <span class="o">{</span><span class="k">return</span> this.age&gt;30<span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">})</span>
</span></span><span class="line"><span class="cl"><span class="c1"># skip 和 limit</span>
</span></span><span class="line"><span class="cl">db.COLLECTION.find<span class="o">()</span>.skip<span class="o">(</span>0<span class="o">)</span>.limit<span class="o">(</span>2<span class="o">)</span>
</span></span><span class="line"><span class="cl">db.COLLECTION.find<span class="o">()</span>.skip<span class="o">(</span>2<span class="o">)</span>.limit<span class="o">(</span>2<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 投影操作，类比mysql中 select name,age from stu;</span>
</span></span><span class="line"><span class="cl">db.COLLECTION.find<span class="o">({}</span>, <span class="o">{</span>name:1, age:1<span class="o">})</span>		<span class="c1"># 想看的字段用1</span>
</span></span><span class="line"><span class="cl">db.COLLECTION.find<span class="o">({}</span>, <span class="o">{</span>_id:0, name:1, age:1<span class="o">})</span> <span class="c1"># 只有_id可以0和1共存，否则要不全是0，要不全是1</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 排序，1为升序，2为降序</span>
</span></span><span class="line"><span class="cl">db.COLLECTION.find<span class="o">()</span>.sort<span class="o">({</span>age:1, gender:-1<span class="o">})</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 去重</span>
</span></span><span class="line"><span class="cl">db.COLLECTION.distinct<span class="o">(</span><span class="s2">&#34;gender&#34;</span>, <span class="o">{</span>age:18<span class="o">})</span>   <span class="c1"># 在年龄为18的查询结果中对性别去重</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 更新，query：查询条件；update：更新操作；multi：默认只更新第一条</span>
</span></span><span class="line"><span class="cl">db.COLLECTION.update<span class="o">({</span>query<span class="o">}</span>, <span class="o">{</span>update<span class="o">}</span>, <span class="o">{</span>multi:boolean<span class="o">})</span>
</span></span><span class="line"><span class="cl">db.COLLECTION.update<span class="o">({</span>name:<span class="s2">&#34;li&#34;</span><span class="o">}</span>, <span class="o">{</span><span class="nv">$set</span>:<span class="o">{</span>age:18<span class="o">}}</span>, <span class="o">{</span>upsert:true<span class="o">})</span>			<span class="c1"># 以upsert模式将姓名为li的年龄更新/设置为18</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 删除</span>
</span></span><span class="line"><span class="cl">db.COLLECTION.remove<span class="o">({})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 管道命令</span>
</span></span><span class="line"><span class="cl">	<span class="nv">$group</span>		分组
</span></span><span class="line"><span class="cl">	<span class="nv">$match</span>		过滤数据
</span></span><span class="line"><span class="cl">	<span class="nv">$project</span>	投影操作， 修改输入文档的结构，如重命名、增/删字段、创建计算结果
</span></span><span class="line"><span class="cl">	<span class="nv">$sort</span>			将输入文档排序后输出
</span></span><span class="line"><span class="cl">	<span class="nv">$limit</span>		限制返回文档的数量
</span></span><span class="line"><span class="cl">	<span class="nv">$skip</span>			跳过指定数量的文档，返回余下的
</span></span></code></pre></td></tr></table>
</div>
</div><table>
<thead>
<tr>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>Object ID</td>
<td>文档ID/数据ID</td>
</tr>
<tr>
<td>String</td>
<td>字符串，必须是有效的UTF-8字符串</td>
</tr>
<tr>
<td>Boolean</td>
<td></td>
</tr>
<tr>
<td>Integer</td>
<td></td>
</tr>
<tr>
<td>Double</td>
<td></td>
</tr>
<tr>
<td>Arrays</td>
<td></td>
</tr>
<tr>
<td>Object</td>
<td></td>
</tr>
<tr>
<td>Null</td>
<td></td>
</tr>
<tr>
<td>Timestamp</td>
<td></td>
</tr>
<tr>
<td>Date</td>
<td></td>
</tr>
</tbody>
</table>
<h4 id="索引">索引</h4>
<p>加快查询速度。</p>
<h4 id="权限管理">权限管理</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 使用admin数据库，超级管理员必须创建在该数据库上</span>
</span></span><span class="line"><span class="cl">use admin
</span></span><span class="line"><span class="cl"><span class="c1"># 创建超级用户</span>
</span></span><span class="line"><span class="cl">db.createUser<span class="o">({</span>user:<span class="s2">&#34;username&#34;</span>, pwd:<span class="s2">&#34;password&#34;</span>, roles:<span class="o">[</span><span class="s2">&#34;root&#34;</span><span class="o">]})</span>
</span></span><span class="line"><span class="cl"><span class="c1"># roles还可以是：read、readWrite</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 登录（在哪里创建在那里登录）</span>
</span></span><span class="line"><span class="cl">db.auth<span class="o">(</span><span class="s2">&#34;username&#34;</span>, <span class="s2">&#34;password&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 显示用户</span>
</span></span><span class="line"><span class="cl">show users
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 配置对于多个数据库具有操作权限，需要在admin上创建</span>
</span></span><span class="line"><span class="cl">db.createUser<span class="o">({</span>user:<span class="s2">&#34;username&#34;</span>, pwd:<span class="s2">&#34;password&#34;</span>, roles:<span class="o">[{</span>db:<span class="s2">&#34;db1&#34;</span>, roles:<span class="s2">&#34;read&#34;</span><span class="o">}</span>, <span class="o">{</span>db:<span class="s2">&#34;db2&#34;</span>, roles:readWrite<span class="o">}]})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 删除用户，需要在超级管理员用户下操作</span>
</span></span><span class="line"><span class="cl">db.dropUser<span class="o">(</span><span class="s2">&#34;username&#34;</span><span class="o">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="pymongo">pymongo</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pymongo</span> <span class="kn">import</span> <span class="n">MongoClient</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 创建数据库链接对象</span>
</span></span><span class="line"><span class="cl"><span class="n">client</span> <span class="o">=</span> <span class="n">MongoClient</span><span class="p">(</span><span class="s1">&#39;xx.xx.xx.xx&#39;</span><span class="p">,</span> <span class="mi">27017</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 选择一个数据库</span>
</span></span><span class="line"><span class="cl"><span class="n">db</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;admin&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 认证</span>
</span></span><span class="line"><span class="cl"><span class="n">db</span><span class="o">.</span><span class="n">authenticate</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 选择一个集合</span>
</span></span><span class="line"><span class="cl"><span class="n">col</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;itheima&#39;</span><span class="p">][</span><span class="s1">&#39;test&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 增删改查</span>
</span></span><span class="line"><span class="cl"><span class="c1"># col.insert({&#34;python&#34;:&#34;python3.7&#34;})</span>
</span></span><span class="line"><span class="cl"><span class="c1"># col.insert({&#34;C++&#34;:&#34;C++17&#34;})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">col</span><span class="o">.</span><span class="n">find</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">col</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&#34;python&#34;</span><span class="p">:</span><span class="s2">&#34;python3.7&#34;</span><span class="p">},</span> <span class="p">{</span><span class="s2">&#34;python&#34;</span><span class="p">:</span><span class="s2">&#34;python3.9&#34;</span><span class="p">},</span> <span class="p">{</span><span class="n">multi</span><span class="p">:</span><span class="n">boolean</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">col</span><span class="o">.</span><span class="n">find</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="scrapy基础">scrapy基础</h3>
<h4 id="各个模块的功能">各个模块的功能</h4>
<ul>
<li>引擎：数据和信号的传递</li>
<li>调度器：任务队列</li>
<li>下载器</li>
<li>爬虫：起始url、解析</li>
<li>管道：保存数据</li>
<li>中间件：定制化操作</li>
</ul>
<h4 id="scrapy项目开发流程">scrapy项目开发流程</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 1、创建项目</span>
</span></span><span class="line"><span class="cl"><span class="n">scrapy</span> <span class="n">startproject</span> <span class="n">news</span>
</span></span><span class="line"><span class="cl"><span class="c1"># x 、建模</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 2、生成爬虫</span>
</span></span><span class="line"><span class="cl"><span class="n">scrapy</span> <span class="n">genspider</span> <span class="n">example</span> <span class="n">example</span><span class="o">.</span><span class="n">com</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 3、提取数据</span>
</span></span><span class="line"><span class="cl"><span class="n">根据网站结构在spider中实现数据采集相关的内容</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 4、保存数据</span>
</span></span><span class="line"><span class="cl"><span class="n">使用pipline进行数据后续处理和保存</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 5、运行爬虫</span>
</span></span><span class="line"><span class="cl"><span class="n">scrapy</span> <span class="n">clawl</span> <span class="n">example</span> <span class="o">--</span><span class="n">nolog</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="scrapy编写爬虫">scrapy编写爬虫</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 1、修改起始url</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 2、修改允许的域</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 3、编写解析函数</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="scrape-中间件">scrape 中间件</h4>
<ul>
<li>下载中间件</li>
<li>爬虫中间件</li>
</ul>
<p>中间件的使用方法：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 1、在middleware.py中定义中间件类</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 2、在中间件类中重写处理请求或响应的方法</span>
</span></span><span class="line"><span class="cl">		<span class="n">process_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">spider</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  			<span class="n">当每个request经过中间件的时候被调用</span>
</span></span><span class="line"><span class="cl">    		<span class="kc">None</span>			<span class="n">如果所有中间件都返回None则交给下载器</span>
</span></span><span class="line"><span class="cl">      	<span class="n">request</span>	  <span class="n">如果返回为请求</span><span class="err">，</span><span class="n">则交给调度器</span>
</span></span><span class="line"><span class="cl">        <span class="n">response</span>	<span class="n">将响应对象交给spider进行解析</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  	<span class="n">process_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">requset</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">spider</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    		<span class="n">当下载器完成http请求</span><span class="err">，</span><span class="n">传递响应给引擎的时候调用</span>
</span></span><span class="line"><span class="cl">      	<span class="n">request</span>	  <span class="n">如果返回为请求</span><span class="err">，</span><span class="n">则交给调度器</span>
</span></span><span class="line"><span class="cl">        <span class="n">response</span>	<span class="n">将响应对象交给spider进行解析</span>    
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl"><span class="c1"># 3、在settings文件中开启中间件，权重越小优先级越高</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="scrapy-redis">scrapy-redis</h3>
<p>通过持久化请求队列和请求的指纹集合来实现：</p>
<ul>
<li>断点续爬</li>
<li>分布式快速爬取</li>
</ul>
<h4 id="scrapy_radis配置">scrapy_radis配置</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 指纹生成以及去重类</span>
</span></span><span class="line"><span class="cl"><span class="n">DUPEFILTER_CLASS</span> <span class="o">=</span> <span class="s2">&#34;scrapy_redis.dupefilter.RFPDupeFilter&#34;</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 调度器类</span>
</span></span><span class="line"><span class="cl"><span class="n">SCHEDULER</span> <span class="o">=</span> <span class="s2">&#34;scrapy_redis.scheduler.Scheduler&#34;</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 持久化请求队列和指纹集合</span>
</span></span><span class="line"><span class="cl"><span class="n">SCHEDULER_PERSIST</span> <span class="o">=</span> <span class="kc">True</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 数据存入redis的管道</span>
</span></span><span class="line"><span class="cl"><span class="n">ITEM_PIPELINES</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;scrapy_redis.pipelines.RedisPipeline&#39;</span><span class="p">:</span> <span class="mi">400</span><span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># redis的url</span>
</span></span><span class="line"><span class="cl"><span class="n">REDIS_URL</span> <span class="o">=</span> <span class="s2">&#34;redis://host:port&#34;</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="分布式爬虫编写流程">分布式爬虫编写流程</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 1、编写普通爬虫</span>
</span></span><span class="line"><span class="cl">		<span class="n">创建项目</span>
</span></span><span class="line"><span class="cl">  	<span class="n">明确目标</span>
</span></span><span class="line"><span class="cl">    <span class="n">创建爬虫</span>
</span></span><span class="line"><span class="cl">    <span class="n">保存内容</span>
</span></span><span class="line"><span class="cl"><span class="c1">#2、改造成分布式爬虫</span>
</span></span><span class="line"><span class="cl">		<span class="mf">1.</span><span class="n">改造爬虫</span>
</span></span><span class="line"><span class="cl">  			<span class="n">导入scrapy_redis中的分布式爬虫类</span>
</span></span><span class="line"><span class="cl">    		<span class="n">继承类</span>
</span></span><span class="line"><span class="cl">      	<span class="n">注销</span> <span class="n">start_urls</span> <span class="n">和</span> <span class="n">allow_domains</span>
</span></span><span class="line"><span class="cl">        <span class="n">设置redis_key获取start_urls</span>
</span></span><span class="line"><span class="cl">        <span class="n">设置</span> <span class="fm">__init__</span> <span class="n">获取允许的域名</span>
</span></span><span class="line"><span class="cl">     <span class="mf">2.</span><span class="n">改造配置文件</span>
</span></span><span class="line"><span class="cl">        <span class="n">copy配置参数</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="scrapy其他">scrapy其他</h3>
<h4 id="scrapy_splash">scrapy_splash</h4>
<p>模拟浏览器加载js，并且返回js运行后的数据。</p>
<h5 id="安装">安装</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 1、splash</span>
</span></span><span class="line"><span class="cl">docker
</span></span><span class="line"><span class="cl"><span class="c1"># 2、python模块</span>
</span></span><span class="line"><span class="cl">pip install scrapy-splash
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="使用">使用</h4>
<ol>
<li>
<p>运行splash服务</p>
</li>
<li>
<p>在代码中使用</p>
<ol>
<li>
<p>创建项目</p>
</li>
<li>
<p>创建爬虫</p>
</li>
<li>
<p>修改配置文件</p>
</li>
<li>
<p>编写代码（重写start_requests方法，创建SplashRequest请求）</p>
</li>
</ol>
</li>
</ol>
<h4 id="scrapy的日志信息和配置">scrapy的日志信息和配置</h4>
<h5 id="scrapy常用配置">scrapy常用配置</h5>
<ul>
<li>
<p>ROBOTSTXT_OBEY：是否遵循爬虫协议</p>
</li>
<li>
<p>UEER_AGENT：ua</p>
</li>
<li>
<p>DEFAULT_REQUEST_HEADERS：默认的请求头</p>
</li>
<li>
<p>COOKIES_ENABLED：是否开启cookies</p>
</li>
<li>
<p>COOKIES_DEBUG：日志中是否显示cookies相关信息</p>
</li>
<li>
<p>LOG_LEVEL：日志等级</p>
</li>
<li>
<p>LOG_FILE：</p>
</li>
<li>
<p>DOWNLOAD_DELAY：</p>
</li>
<li>
<p>CONCURRENT_REQUESTS：并发量</p>
</li>
<li>
<p>CONCURRENT_REQUESTS_PER_DOMAIN</p>
</li>
<li>
<p>CONCURRENT_REQUESTS_PER_IP：</p>
</li>
</ul>
<h4 id="scrapyd">scrapyd</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># server</span>
</span></span><span class="line"><span class="cl">pip install scrapyd
</span></span><span class="line"><span class="cl"><span class="c1"># client</span>
</span></span><span class="line"><span class="cl">pip install scrapy-client
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 配置 scrapy.cfg</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>deploy:部署名<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nv">url</span> <span class="o">=</span> http://localhost:6800/
</span></span><span class="line"><span class="cl"><span class="nv">project</span> <span class="o">=</span> JD		<span class="c1"># 这儿的是项目名</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 部署</span>
</span></span><span class="line"><span class="cl">scrapyd-deploy 部署名 -q 项目名
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 启动爬虫</span>
</span></span><span class="line"><span class="cl">curl http://localhost:6800/schedule.json -d <span class="nv">project</span><span class="o">=</span>project_name -d <span class="nv">spider</span><span class="o">=</span>spider_name
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="gerapy">gerapy</h4>
<p>基于scrapyd的分布式爬虫管理框架</p>
<h3 id="appium">appium</h3>
<h2 id="增量式爬虫">增量式爬虫</h2>
<p>新闻网站会不定期的更新，不论是新页面的产生，还是原页面的内容被修改，这些变化都可视作增量，需要让爬虫检测网站更新情况以获得最新的数据。爬虫爬取的过车过是“请求 -&gt; 响应 -&gt; 解析 -&gt; 存储”，那么思路有：</p>
<ul>
<li>发送请求前判断URL是否爬取过（适用于网站更新但原内容不更新的情况）</li>
<li>解析内容后判断内容是否之前爬取过（适用于页面内容更新的情况）</li>
<li>持久化存储的时候判断是否已在存储介质中</li>
</ul>
<p>增量式爬虫的核心在于去重，也即使用数据指纹，常用的是哈希值。除了数据指纹，参考的文章中还提到了304状态码、Last-modified字段、文件大小、MD5签名等。</p>
<h3 id="bloomfilter">BloomFilter</h3>
<p>常年不更新了，不支持python3。</p>
<h3 id="redis">Redis</h3>
<h3 id="定时爬虫">定时爬虫</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 每天的十点启动</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">apscheduler.schedulers.blocking</span> <span class="kn">import</span> <span class="n">BlockingScheduler</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">run</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">sched</span> <span class="o">=</span> <span class="n">BlockingScheduler</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">sched</span><span class="o">.</span><span class="n">add_job</span><span class="p">(</span><span class="n">run</span><span class="p">,</span> <span class="s1">&#39;cron&#39;</span><span class="p">,</span> <span class="n">hour</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">minute</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">sched</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 每隔三分钟启动一次</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">apscheduler.schedulers.blocking</span> <span class="kn">import</span> <span class="n">BlockingScheduler</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">run</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">sched</span> <span class="o">=</span> <span class="n">BlockingScheduler</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">sched</span><span class="o">.</span><span class="n">add_job</span><span class="p">(</span><span class="n">run</span><span class="p">,</span> <span class="s1">&#39;interval&#39;</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">sched</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="scrapy">Scrapy</h2>
<p>文档：<a href="https://docs.scrapy.org/en/latest/">scrapy documentation</a></p>
<h2 id="参考">参考</h2>
<p><a href="https://www.jianshu.com/p/7f2be7eed247">爬虫的增量式抓取和数据更新</a></p>
    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/andorid/">andorid</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/hello-world/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Hello World</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/%E9%BB%91%E4%B9%A6%E6%85%A2%E8%AF%BB/">
            <span class="next-text nav-default">黑书慢读</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=Snl5fn5-e318cn0KOztkKSUn" class="iconfont icon-email" title="email"></a>
      <a href="https://stackoverflow.com/users/9786406/lttzz" class="iconfont icon-stack-overflow" title="stack-overflow"></a>
      <a href="https://github.com/lttzz" class="iconfont icon-github" title="github"></a>
      <a href="https://weibo.com/lttzz" class="iconfont icon-weibo" title="weibo"></a>
      <a href="https://www.douban.com/people/196540309/" class="iconfont icon-douban" title="douban"></a>
      <a href="https://space.bilibili.com/74153503" class="iconfont icon-bilibili" title="bilibili"></a>
  <a href="https://lttzz.github.io/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  <div class="busuanzi-footer">
    <span id="busuanzi_container_site_pv"> site pv: <span id="busuanzi_value_site_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> </span>
      <span class="division">|</span>
    <span id="busuanzi_container_site_uv"> site uv: <span id="busuanzi_value_site_uv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> </span>
  </div>

  <span class="copyright-year">
    &copy; 
    2019 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span>lttzz</span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-140228231-1', 'auto');
	ga('set', 'anonymizeIp', true);
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>







</body>
</html>
